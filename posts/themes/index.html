<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
         
        <link rel="stylesheet" href="/libs/highlight/styles/github.min.css">
 
        <link rel="stylesheet" href="/css/reset.css" />
        <link rel="stylesheet" href="/css/normalize.css" />
        <link rel="stylesheet" href="/css/basic.css" />
        <link rel="icon" href="/assets/favicon.png" />
        
        <title>Basics of Making Makie Themes for TidierPlots</title>
        
    </head>
    <body>
        <table class="header">
    <tr>
        <td colspan="2" rowspan="3" scope="header" class="width-min">
            <h1 class="title">randy.pub</h1>
            <span class="subtitle">Personal homepage</span>
        </td>
        <td scope="header" class="width-min">Author</td>
        <td scope="header" class="width-auto">Randy Boyes</td>
    </tr>
    <tr>
        <td scope="header" class="width-min">Updated</td>
        <td scope="header" class="width-auto">
            <time> December 06, 2024</time>
        </td>
    </tr>
    <tr>
        <td scope="header" class="width-min">Nav</td>
        <td scope="header" class="width-auto">
            <a href="/">Home</a>
            <a href="/pubs/">Publications</a>
            <a href="/resume/">Resume</a>
            <a href="/posts/">Posts</a>
        </td>
    </tr>
</table>
<label class="debug-toggle-label"
    ><input type="checkbox" class="debug-toggle" /> Debug mode</label
>


        <!-- Content appended here -->
    </body>
    <div class="debug-grid"></div>
    <script>
        function gridCellDimensions() {
            const element = document.createElement("div");
            element.style.position = "fixed";
            element.style.height = "var(--line-height)";
            element.style.width = "1ch";
            document.body.appendChild(element);
            const rect = element.getBoundingClientRect();
            document.body.removeChild(element);
            return { width: rect.width, height: rect.height };
        }

        // Add padding to each media to maintain grid.
        function adjustMediaPadding() {
            const cell = gridCellDimensions();

            function setHeightFromRatio(media, ratio) {
                const rect = media.getBoundingClientRect();
                const realHeight = rect.width / ratio;
                const diff = cell.height - (realHeight % cell.height);
                media.style.setProperty("padding-bottom", `${diff}px`);
            }

            function setFallbackHeight(media) {
                const rect = media.getBoundingClientRect();
                const height =
                    Math.round(rect.width / 2 / cell.height) * cell.height;
                media.style.setProperty("height", `${height}px`);
            }

            function onMediaLoaded(media) {
                var width, height;
                switch (media.tagName) {
                    case "IMG":
                        width = media.naturalWidth;
                        height = media.naturalHeight;
                        break;
                    case "VIDEO":
                        width = media.videoWidth;
                        height = media.videoHeight;
                        break;
                }
                if (width > 0 && height > 0) {
                    setHeightFromRatio(media, width / height);
                } else {
                    setFallbackHeight(media);
                }
            }

            const medias = document.querySelectorAll("img, video");
            for (media of medias) {
                switch (media.tagName) {
                    case "IMG":
                        if (media.complete) {
                            onMediaLoaded(media);
                        } else {
                            media.addEventListener("load", () =>
                                onMediaLoaded(media),
                            );
                            media.addEventListener("error", function () {
                                setFallbackHeight(media);
                            });
                        }
                        break;
                    case "VIDEO":
                        switch (media.readyState) {
                            case HTMLMediaElement.HAVE_CURRENT_DATA:
                            case HTMLMediaElement.HAVE_FUTURE_DATA:
                            case HTMLMediaElement.HAVE_ENOUGH_DATA:
                                onMediaLoaded(media);
                                break;
                            default:
                                media.addEventListener("loadeddata", () =>
                                    onMediaLoaded(media),
                                );
                                media.addEventListener("error", function () {
                                    setFallbackHeight(media);
                                });
                                break;
                        }
                        break;
                }
            }
        }

        adjustMediaPadding();
        window.addEventListener("load", adjustMediaPadding);
        window.addEventListener("resize", adjustMediaPadding);

        function checkOffsets() {
            const ignoredTagNames = new Set([
                "THEAD",
                "TBODY",
                "TFOOT",
                "TR",
                "TD",
                "TH",
            ]);
            const cell = gridCellDimensions();
            const elements = document.querySelectorAll(
                "body :not(.debug-grid, .debug-toggle)",
            );
            for (const element of elements) {
                if (ignoredTagNames.has(element.tagName)) {
                    continue;
                }
                const rect = element.getBoundingClientRect();
                if (rect.width === 0 && rect.height === 0) {
                    continue;
                }
                const top = rect.top + window.scrollY;
                const left = rect.left + window.scrollX;
                const offset = top % (cell.height / 2);
                if (offset > 0) {
                    element.classList.add("off-grid");
                    console.error(
                        "Incorrect vertical offset for",
                        element,
                        "with remainder",
                        top % cell.height,
                        "when expecting divisible by",
                        cell.height / 2,
                    );
                } else {
                    element.classList.remove("off-grid");
                }
            }
        }

        const debugToggle = document.querySelector(".debug-toggle");
        function onDebugToggle() {
            document.body.classList.toggle("debug", debugToggle.checked);
        }
        debugToggle.addEventListener("change", onDebugToggle);
        onDebugToggle();
    </script>
</html>
<div class="franklin-content"><h2 id="themes"><a href="#themes" class="header-anchor">Themes</a></h2>
<p>TidierPlots.jl has full support for Makie themes. For example:</p>
<pre><code class="julia hljs"><span class="hljs-keyword">using</span> TidierPlots
<span class="hljs-keyword">using</span> Random
<span class="hljs-keyword">using</span> DataFrames
<span class="hljs-keyword">using</span> Makie

Random.seed!(<span class="hljs-number">123</span>)
n = <span class="hljs-number">200</span>
df = DataFrame(x = randn(n) / <span class="hljs-number">2</span>, y = randn(n))

plot1 = ggplot(df) +
    geom_histogram(aes(x = :x),
      color = (:orangered, <span class="hljs-number">0.5</span>),
      strokewidth = <span class="hljs-number">0.5</span>) +
    lims(x = c(-<span class="hljs-number">4</span>, <span class="hljs-number">4</span>)) + theme_minimal() <span class="hljs-comment"># theme_minimal is from Makie</span></code></pre>
<img src="/assets/posts/themes/code/output/themes_plot1.png" alt="">
<p>Lets make this plot fit a little better with the monospace theme we&#39;ve got going on this site. First - the most obvious change. We need to change the font.</p>
<pre><code class="julia hljs">juliamono = <span class="hljs-string">&quot;https://cdn.jsdelivr.net/gh/cormullion/juliamono/webfonts/JuliaMono-Light.woff2&quot;</span>

randy_pub_theme = Theme(
  fonts=(;regular=juliamono)
)

plot2 = ggplot(df) +
    geom_histogram(aes(x = :x),
      color = (:orangered, <span class="hljs-number">0.5</span>),
      strokewidth = <span class="hljs-number">0.5</span>) +
    lims(x = c(-<span class="hljs-number">4</span>, <span class="hljs-number">4</span>)) + randy_pub_theme</code></pre>
<img src="/assets/posts/themes/code/output/themes_plot2.png" alt="">
<p>The syntax looks a little funny if you&#39;re coming from R, so it&#39;s worth a little detour to talk about which elements can be used in themes, and how to pass them in. Makie themes can contain settings for the Attributes of any object. To change the font, we want to edit the <a href="https://docs.makie.org/stable/reference/plots/text#fonts">&quot;fonts&quot; Attribute</a> of the Figure which says it needs a &quot;dictionary&quot; that ties font styles &#40;e.g. &quot;regular&quot;&#41; to fonts &#40;&quot;JuliaMono-Light&quot;&#41;. I honestly don&#39;t know why it says it wants a dictionary and then demands a named tuple instead, but that&#39;s the way it works. For more info, see the explanation <a href="https://docs.makie.org/stable/explanations/fonts">here</a>.</p>
<p>Edits to the overall figure are done directly within the Theme call, while changes to <a href="https://docs.makie.org/stable/explanations/blocks">&quot;Blocks&quot;</a> are done within a &quot;UppercaseBlockName &#61; &#40;tuple of Attributes&#41;&quot; argument to Theme. We&#39;re going to need to change a lot of options for Axis &#40;whose Attributes are listed <a href="https://docs.makie.org/stable/reference/blocks/axis#attributes">here</a> in order to make this theme look right. Lets start by getting rid of the background and all of the axis lines except the bottom.</p>
<pre><code class="julia hljs">randy_pub_theme = Theme(
    fonts=(;regular=juliamono),
    backgroundcolor = :transparent,
    Axis = (
            backgroundcolor = :transparent,
            leftspinevisible = <span class="hljs-literal">false</span>,
            rightspinevisible = <span class="hljs-literal">false</span>,
            topspinevisible = <span class="hljs-literal">false</span>,
            xgridcolor = :transparent,
            ygridcolor = :transparent,
        )
)

plot3 = ggplot(df) +
    geom_histogram(aes(x = :x),
      color = (:transparent, <span class="hljs-number">0.5</span>), strokewidth = <span class="hljs-number">1</span>) +
    lims(x = c(-<span class="hljs-number">4</span>, <span class="hljs-number">4</span>)) + randy_pub_theme</code></pre>
<img src="/assets/posts/themes/code/output/themes_plot3.png" alt="">
<p>Notice that there are two different calls to &quot;background &#61; :transparent&quot;. The one inside the Axis group makes the Axis background transparent, and the one at the base level makes the figure&#39;s background transparent.</p>
<p>Now we need to align the figure with the monospace grid.</p>
<pre><code class="julia hljs">randy_pub_theme = Theme(
    fonts=(;regular=juliamono),
    backgroundcolor = :transparent,
    Axis = (
            backgroundcolor = :transparent,
            leftspinevisible = <span class="hljs-literal">false</span>,
            rightspinevisible = <span class="hljs-literal">false</span>,
            topspinevisible = <span class="hljs-literal">false</span>,
            xgridcolor = :transparent,
            ygridcolor = :transparent,
            width = <span class="hljs-number">468</span>,
            height = <span class="hljs-number">365</span>,
            yticklabelpad = <span class="hljs-number">.25</span>,
        ),
        Hist = (strokewidth = <span class="hljs-number">1</span>, bins = <span class="hljs-number">21</span>)
)

plot3a = ggplot(df) +
    geom_histogram(aes(x = :x),
      color = (:transparent, <span class="hljs-number">0.5</span>), strokewidth = <span class="hljs-number">1</span>) +
    lims(x = c(-<span class="hljs-number">4</span>, <span class="hljs-number">4</span>), y = c(<span class="hljs-number">0</span>, <span class="hljs-number">30</span>)) + randy_pub_theme</code></pre>
<img src="/assets/posts/themes/code/output/themes_plot3a.png" alt="">
<p>We need to tweak the colors now for dark mode:</p>
<pre><code class="julia hljs">randy_pub_theme_dark = Theme(
    fonts=(;regular=juliamono),
    backgroundcolor = :transparent,
    Axis = (
            backgroundcolor = :transparent,
            leftspinevisible = <span class="hljs-literal">false</span>,
            rightspinevisible = <span class="hljs-literal">false</span>,
            topspinevisible = <span class="hljs-literal">false</span>,
            bottomspinecolor = :white,
            xticklabelcolor = :white,
            xtickcolor = :white,
            yticklabelcolor = :white,
            ytickcolor = :white,
            xgridcolor = :transparent,
            ygridcolor = :transparent,
            width = <span class="hljs-number">468</span>,
            height = <span class="hljs-number">365</span>,
            yticklabelpad = <span class="hljs-number">.25</span>
        ),
    Hist = (strokecolor = :white, strokewidth = <span class="hljs-number">1</span>, bins = <span class="hljs-number">21</span>)
)

plot4 = ggplot(df) +
    geom_histogram(aes(x = :x),
      color = (:transparent, <span class="hljs-number">0.5</span>)) +
    lims(x = c(-<span class="hljs-number">4</span>, <span class="hljs-number">4</span>), y = c(<span class="hljs-number">0</span>, <span class="hljs-number">30</span>)) + randy_pub_theme_dark</code></pre>
<img src="/assets/posts/themes/code/output/themes_plot4.png" alt="">
<p>Success&#33; There&#39;s lots more than can be done here but I&#39;m happy with the basic look. We can also use a little html to swap out the theme based on user&#39;s dark mode setting:</p>

<picture>
  <source
    srcset="/assets/posts/themes/code/output/themes_plot4.png"
    media="(prefers-color-scheme: dark)"
  />
  <img
    src="/assets/posts/themes/code/output/themes_plot3a.png"
  />
</picture>

<hr />
<div class="page-foot">
    <a href="https://opensource.org/license/mit">MIT License</a> Randy Boyes.  Website built with
    <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the
    <a href="https://julialang.org">Julia programming language</a>. Design
    inspired by
    <a href="https://owickstrom.github.io/the-monospace-web/"
        >The Monospace Web</a
    >. Code for this website is available on
    <a href="https://github.com/rdboyes/randy-pub">Github</a>.
</div>
</div><!-- CONTENT ENDS HERE -->
    
    
        <script src="/libs/highlight/highlight.min.js"></script>
<script>
    hljs.highlightAll();
    hljs.configure({ tabReplace: "    " });
</script>

    
  </body>
</html>
