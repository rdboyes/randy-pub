@def title = "Knitting Quarto Docs with a Dynamic Number of Figures"
@def date = "03/31/2025"
@def tags = ["r", "quarto"]

## Goal

Inspired by a post I saw on Bluesky, what is the easiest way to knit a quarto document that contains a dynamic number of figures - e.g. a plot for each question in a survey?

## Solution

The best way I've found is to use two files: one for the main document, and one that will serve as the "template" for the figures. The main document will have a loop that calls `knit_child` with the template multiple times.

Here's a simple example:

## Main File

`````txt
---
title: "Variable Number of Figures"
format: typst
---

# An Example Report

```{r, include = FALSE}
library(tibble)
library(dplyr)
library(ggplot2)

knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)

data <- tibble(
    q = rep(c("1", "2", "3"), each = 100),
    v = c(runif(100), rnorm(100), rexp(100))
)
```

```{r, results = "hide"}
out = NULL
for(q in unique(data$q)){
    question <- q
    out <- c(out, knitr::knit_child("child.qmd"))
}
```

```{r, results = "asis"}
cat(paste(out, collapse="\n") )
```
`````

## child.qmd

`````txt
# Question `r question`

```{r, results = "hide"}
dist = case_when(
  q == "1" ~ "Uniform",
  q == "2" ~ "Normal",
  TRUE ~ "Exponential")
```

Here's some text, it could talk about the distribution that the data came from, which in this case is the `r dist`.

```{r}
ggplot(filter(data, q == question)) +
    geom_histogram(aes(x = v))
```
`````

## Result

The pdf document that is generated by rendering or previewing the main document in quarto is available [here.](/assets/multi.pdf)

---
